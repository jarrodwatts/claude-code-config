{
  "meta": {
    "version": "1.1",
    "generated": "2026-01-12",
    "pass": 2,
    "repo": "claude-code-config/san-juan",
    "corrections": [
      "Fixed keyword-detector edges: now type=context-injection (suggestions, not dispatches)",
      "Fixed review agent edges: now conditional based on file types per routing table",
      "Added all 14 review agent conditional edges",
      "Added 5 context mode nodes for keyword-detector targets"
    ]
  },
  "nodes": [
    {
      "id": "entry:user-prompt",
      "type": "entry",
      "label": "User Prompt",
      "evidence": "Claude Code runtime"
    },
    {
      "id": "entry:slash-command",
      "type": "entry",
      "label": "Slash Command",
      "evidence": "Claude Code /command syntax"
    },
    {
      "id": "entry:tool-use",
      "type": "entry",
      "label": "Tool Invocation",
      "evidence": "Claude Code tool calls"
    },
    {
      "id": "entry:session-stop",
      "type": "entry",
      "label": "Session Stop",
      "evidence": "User exit or task complete"
    },
    {
      "id": "context:ultrawork-mode",
      "type": "context",
      "label": "Ultrawork Mode",
      "note": "Suggests parallel execution, comprehensive planning, thorough verification",
      "evidence": "hooks/keyword-detector.py:22-38"
    },
    {
      "id": "context:delegation-mode",
      "type": "context",
      "label": "Delegation Mode",
      "note": "Suggests native workflows + Codex handoff for adversarial review",
      "evidence": "hooks/keyword-detector.py:41-62"
    },
    {
      "id": "context:search-mode",
      "type": "context",
      "label": "Search Mode",
      "note": "Suggests parallel searches, multiple angles, exhaustive matching",
      "evidence": "hooks/keyword-detector.py:65-85"
    },
    {
      "id": "context:analysis-mode",
      "type": "context",
      "label": "Analysis Mode",
      "note": "Suggests deep investigation, oracle consultation, evidence gathering",
      "evidence": "hooks/keyword-detector.py:88-108"
    },
    {
      "id": "context:think-mode",
      "type": "context",
      "label": "Think Mode",
      "note": "Suggests extended reasoning, multiple perspectives, trade-off analysis",
      "evidence": "hooks/keyword-detector.py:111-127"
    },
    {
      "id": "hook:keyword-detector",
      "type": "hook",
      "label": "keyword-detector.py",
      "event": "UserPromptSubmit",
      "blocking": false,
      "evidence": "hooks/keyword-detector.py"
    },
    {
      "id": "hook:check-comments",
      "type": "hook",
      "label": "check-comments.py",
      "event": "PostToolUse",
      "matcher": "Write|Edit",
      "blocking": false,
      "evidence": "hooks/check-comments.py"
    },
    {
      "id": "hook:require-green-tests",
      "type": "hook",
      "label": "require-green-tests.sh",
      "event": "Stop",
      "blocking": true,
      "evidence": "hooks/workflows/require-green-tests.sh"
    },
    {
      "id": "hook:todo-enforcer",
      "type": "hook",
      "label": "todo-enforcer.sh",
      "event": "Stop",
      "blocking": true,
      "evidence": "hooks/todo-enforcer.sh"
    },
    {
      "id": "cmd:interview",
      "type": "command",
      "label": "/interview",
      "allowedTools": ["AskUserQuestion", "Read", "Glob", "Grep", "Write", "Edit"],
      "evidence": "commands/interview.md"
    },
    {
      "id": "cmd:workflows-brainstorm",
      "type": "command",
      "label": "/workflows/brainstorm",
      "allowedTools": ["AskUserQuestion", "Read", "Glob", "Grep"],
      "evidence": "commands/workflows/brainstorm.md"
    },
    {
      "id": "cmd:workflows-plan",
      "type": "command",
      "label": "/workflows/plan",
      "allowedTools": ["Read", "Glob", "Grep", "Write", "Edit"],
      "evidence": "commands/workflows/plan.md"
    },
    {
      "id": "cmd:workflows-work",
      "type": "command",
      "label": "/workflows/work",
      "allowedTools": ["Read", "Glob", "Grep", "Write", "Edit", "Bash"],
      "evidence": "commands/workflows/work.md"
    },
    {
      "id": "cmd:workflows-review",
      "type": "command",
      "label": "/workflows/review",
      "allowedTools": ["Read", "Glob", "Grep", "Bash", "TodoWrite"],
      "evidence": "commands/workflows/review.md"
    },
    {
      "id": "cmd:workflows-compound",
      "type": "command",
      "label": "/workflows/compound",
      "allowedTools": ["Read", "Glob", "Grep", "Write", "Edit"],
      "evidence": "commands/workflows/compound.md"
    },
    {
      "id": "cmd:delegator-setup",
      "type": "command",
      "label": "/claude-delegator/setup",
      "evidence": "commands/claude-delegator/setup.md"
    },
    {
      "id": "cmd:delegator-task",
      "type": "command",
      "label": "/claude-delegator/task",
      "allowedTools": ["Read", "AskUserQuestion", "Bash", "mcp__codex__codex"],
      "evidence": "commands/claude-delegator/task.md"
    },
    {
      "id": "cmd:delegator-uninstall",
      "type": "command",
      "label": "/claude-delegator/uninstall",
      "evidence": "commands/claude-delegator/uninstall.md"
    },
    {
      "id": "skill:planning-with-files",
      "type": "skill",
      "label": "planning-with-files",
      "evidence": "skills/planning-with-files/SKILL.md"
    },
    {
      "id": "skill:brainstorming",
      "type": "skill",
      "label": "brainstorming",
      "evidence": "skills/brainstorming/SKILL.md"
    },
    {
      "id": "skill:writing-plans",
      "type": "skill",
      "label": "writing-plans",
      "evidence": "skills/writing-plans/SKILL.md"
    },
    {
      "id": "skill:executing-plans",
      "type": "skill",
      "label": "executing-plans",
      "evidence": "skills/executing-plans/SKILL.md"
    },
    {
      "id": "skill:test-driven-development",
      "type": "skill",
      "label": "test-driven-development",
      "evidence": "skills/test-driven-development/SKILL.md"
    },
    {
      "id": "skill:systematic-debugging",
      "type": "skill",
      "label": "systematic-debugging",
      "evidence": "skills/systematic-debugging/SKILL.md"
    },
    {
      "id": "skill:verification-before-completion",
      "type": "skill",
      "label": "verification-before-completion",
      "evidence": "skills/verification-before-completion/SKILL.md"
    },
    {
      "id": "skill:subagent-driven-development",
      "type": "skill",
      "label": "subagent-driven-development",
      "evidence": "skills/subagent-driven-development/SKILL.md"
    },
    {
      "id": "skill:dispatching-parallel-agents",
      "type": "skill",
      "label": "dispatching-parallel-agents",
      "evidence": "skills/dispatching-parallel-agents/SKILL.md"
    },
    {
      "id": "skill:requesting-code-review",
      "type": "skill",
      "label": "requesting-code-review",
      "evidence": "skills/requesting-code-review/SKILL.md"
    },
    {
      "id": "skill:receiving-code-review",
      "type": "skill",
      "label": "receiving-code-review",
      "evidence": "skills/receiving-code-review/SKILL.md"
    },
    {
      "id": "skill:finishing-a-development-branch",
      "type": "skill",
      "label": "finishing-a-development-branch",
      "evidence": "skills/finishing-a-development-branch/SKILL.md"
    },
    {
      "id": "skill:using-git-worktrees",
      "type": "skill",
      "label": "using-git-worktrees",
      "evidence": "skills/using-git-worktrees/SKILL.md"
    },
    {
      "id": "skill:using-workflows",
      "type": "skill",
      "label": "using-workflows",
      "evidence": "skills/using-workflows/SKILL.md"
    },
    {
      "id": "skill:writing-skills",
      "type": "skill",
      "label": "writing-skills",
      "evidence": "skills/writing-skills/SKILL.md"
    },
    {
      "id": "skill:react-useeffect",
      "type": "skill",
      "label": "react-useeffect",
      "evidence": "skills/ReactUseEffect/SKILL.md"
    },
    {
      "id": "skill:compound",
      "type": "skill",
      "label": "compound",
      "evidence": "skills/Compound/SKILL.md"
    },
    {
      "id": "skill:review",
      "type": "skill",
      "label": "review",
      "evidence": "skills/Review/SKILL.md"
    },
    {
      "id": "agent:codebase-search",
      "type": "agent",
      "label": "codebase-search",
      "model": "haiku",
      "evidence": "agents/codebase-search.md"
    },
    {
      "id": "agent:open-source-librarian",
      "type": "agent",
      "label": "open-source-librarian",
      "model": "sonnet",
      "evidence": "agents/open-source-librarian.md"
    },
    {
      "id": "agent:oracle",
      "type": "agent",
      "label": "oracle",
      "model": "opus",
      "evidence": "agents/oracle.md"
    },
    {
      "id": "agent:tech-docs-writer",
      "type": "agent",
      "label": "tech-docs-writer",
      "model": "sonnet",
      "evidence": "agents/tech-docs-writer.md"
    },
    {
      "id": "agent:media-interpreter",
      "type": "agent",
      "label": "media-interpreter",
      "model": "sonnet",
      "evidence": "agents/media-interpreter.md"
    },
    {
      "id": "agent:review-security-sentinel",
      "type": "agent",
      "label": "security-sentinel",
      "model": "haiku",
      "evidence": "agents/review/security-sentinel.md"
    },
    {
      "id": "agent:review-performance-oracle",
      "type": "agent",
      "label": "performance-oracle",
      "model": "sonnet",
      "evidence": "agents/review/performance-oracle.md"
    },
    {
      "id": "agent:review-architecture-strategist",
      "type": "agent",
      "label": "architecture-strategist",
      "model": "sonnet",
      "evidence": "agents/review/architecture-strategist.md"
    },
    {
      "id": "agent:review-data-migration-expert",
      "type": "agent",
      "label": "data-migration-expert",
      "model": "sonnet",
      "evidence": "agents/review/data-migration-expert.md"
    },
    {
      "id": "agent:review-deployment-verification",
      "type": "agent",
      "label": "deployment-verification",
      "model": "sonnet",
      "evidence": "agents/review/deployment-verification.md"
    },
    {
      "id": "agent:review-code-simplicity",
      "type": "agent",
      "label": "code-simplicity",
      "model": "haiku",
      "evidence": "agents/review/code-simplicity.md"
    },
    {
      "id": "agent:review-data-integrity-guardian",
      "type": "agent",
      "label": "data-integrity-guardian",
      "model": "sonnet",
      "evidence": "agents/review/data-integrity-guardian.md"
    },
    {
      "id": "agent:review-pattern-recognition",
      "type": "agent",
      "label": "pattern-recognition",
      "model": "sonnet",
      "evidence": "agents/review/pattern-recognition.md"
    },
    {
      "id": "agent:review-agent-native",
      "type": "agent",
      "label": "agent-native",
      "model": "sonnet",
      "evidence": "agents/review/agent-native.md"
    },
    {
      "id": "agent:review-typescript",
      "type": "agent",
      "label": "typescript",
      "model": "haiku",
      "evidence": "agents/review/typescript.md"
    },
    {
      "id": "agent:review-rails",
      "type": "agent",
      "label": "rails",
      "model": "haiku",
      "evidence": "agents/review/rails.md"
    },
    {
      "id": "agent:review-python",
      "type": "agent",
      "label": "python",
      "model": "haiku",
      "evidence": "agents/review/python.md"
    },
    {
      "id": "agent:review-dhh-rails",
      "type": "agent",
      "label": "dhh-rails",
      "model": "sonnet",
      "evidence": "agents/review/dhh-rails.md"
    },
    {
      "id": "agent:review-frontend-races",
      "type": "agent",
      "label": "frontend-races",
      "model": "sonnet",
      "evidence": "agents/review/frontend-races.md"
    },
    {
      "id": "expert:architect",
      "type": "expert",
      "label": "architect",
      "mode": "advisory",
      "evidence": "prompts/delegator/architect.md"
    },
    {
      "id": "expert:plan-reviewer",
      "type": "expert",
      "label": "plan-reviewer",
      "mode": "advisory",
      "evidence": "prompts/delegator/plan-reviewer.md"
    },
    {
      "id": "expert:scope-analyst",
      "type": "expert",
      "label": "scope-analyst",
      "mode": "advisory",
      "evidence": "prompts/delegator/scope-analyst.md"
    },
    {
      "id": "expert:code-reviewer",
      "type": "expert",
      "label": "code-reviewer",
      "mode": "advisory",
      "evidence": "prompts/delegator/code-reviewer.md"
    },
    {
      "id": "expert:security-analyst",
      "type": "expert",
      "label": "security-analyst",
      "mode": "advisory",
      "evidence": "prompts/delegator/security-analyst.md"
    },
    {
      "id": "rule:typescript",
      "type": "rule",
      "label": "typescript.md",
      "scope": "**/*.{ts,tsx}",
      "evidence": "rules/typescript.md"
    },
    {
      "id": "rule:testing",
      "type": "rule",
      "label": "testing.md",
      "scope": "**/*.{test,spec}.ts",
      "evidence": "rules/testing.md"
    },
    {
      "id": "rule:comments",
      "type": "rule",
      "label": "comments.md",
      "scope": "all",
      "evidence": "rules/comments.md"
    },
    {
      "id": "rule:forge",
      "type": "rule",
      "label": "forge.md",
      "scope": "**/*.sol",
      "evidence": "rules/forge.md"
    },
    {
      "id": "rule:delegator-orchestration",
      "type": "rule",
      "label": "delegator/orchestration.md",
      "evidence": "rules/delegator/orchestration.md"
    },
    {
      "id": "rule:delegator-triggers",
      "type": "rule",
      "label": "delegator/triggers.md",
      "evidence": "rules/delegator/triggers.md"
    },
    {
      "id": "rule:delegator-model-selection",
      "type": "rule",
      "label": "delegator/model-selection.md",
      "evidence": "rules/delegator/model-selection.md"
    },
    {
      "id": "rule:delegator-delegation-format",
      "type": "rule",
      "label": "delegator/delegation-format.md",
      "evidence": "rules/delegator/delegation-format.md"
    }
  ],
  "edges": [
    {
      "from": "entry:user-prompt",
      "to": "hook:keyword-detector",
      "condition": "always",
      "evidence": "settings.json.example:UserPromptSubmit"
    },
    {
      "from": "entry:slash-command",
      "to": "cmd:interview",
      "condition": "/interview",
      "evidence": "Claude Code command routing"
    },
    {
      "from": "entry:slash-command",
      "to": "cmd:workflows-brainstorm",
      "condition": "/workflows/brainstorm",
      "evidence": "Claude Code command routing"
    },
    {
      "from": "entry:slash-command",
      "to": "cmd:workflows-plan",
      "condition": "/workflows/plan",
      "evidence": "Claude Code command routing"
    },
    {
      "from": "entry:slash-command",
      "to": "cmd:workflows-work",
      "condition": "/workflows/work",
      "evidence": "Claude Code command routing"
    },
    {
      "from": "entry:slash-command",
      "to": "cmd:workflows-review",
      "condition": "/workflows/review",
      "evidence": "Claude Code command routing"
    },
    {
      "from": "entry:slash-command",
      "to": "cmd:workflows-compound",
      "condition": "/workflows/compound",
      "evidence": "Claude Code command routing"
    },
    {
      "from": "entry:slash-command",
      "to": "cmd:delegator-setup",
      "condition": "/claude-delegator/setup",
      "evidence": "Claude Code command routing"
    },
    {
      "from": "entry:slash-command",
      "to": "cmd:delegator-task",
      "condition": "/claude-delegator/task",
      "evidence": "Claude Code command routing"
    },
    {
      "from": "entry:slash-command",
      "to": "cmd:delegator-uninstall",
      "condition": "/claude-delegator/uninstall",
      "evidence": "Claude Code command routing"
    },
    {
      "from": "entry:tool-use",
      "to": "hook:check-comments",
      "condition": "Write|Edit",
      "evidence": "settings.json.example:PostToolUse"
    },
    {
      "from": "entry:session-stop",
      "to": "hook:require-green-tests",
      "condition": "always",
      "evidence": "settings.json.example:Stop"
    },
    {
      "from": "entry:session-stop",
      "to": "hook:todo-enforcer",
      "condition": "always",
      "evidence": "settings.json.example:Stop"
    },
    {
      "from": "hook:keyword-detector",
      "to": "context:ultrawork-mode",
      "type": "context-injection",
      "condition": "ultrawork|ulw|ultra\\s*work",
      "note": "Injects additionalContext suggesting parallel execution - does NOT dispatch",
      "evidence": "hooks/keyword-detector.py:22-38"
    },
    {
      "from": "hook:keyword-detector",
      "to": "context:delegation-mode",
      "type": "context-injection",
      "condition": "multi[-\\s]*agent|delegate|delegation|parallelize|parallel|sub[-\\s]*agent|gpt|codex|delegator",
      "note": "Injects additionalContext suggesting delegation patterns - does NOT dispatch",
      "evidence": "hooks/keyword-detector.py:41-62"
    },
    {
      "from": "hook:keyword-detector",
      "to": "context:search-mode",
      "type": "context-injection",
      "condition": "search|find|locate|where\\s+is",
      "note": "Injects additionalContext suggesting parallel searches - does NOT dispatch",
      "evidence": "hooks/keyword-detector.py:65-85"
    },
    {
      "from": "hook:keyword-detector",
      "to": "context:analysis-mode",
      "type": "context-injection",
      "condition": "analyze|investigate|debug|diagnose",
      "note": "Injects additionalContext suggesting deep investigation - does NOT dispatch",
      "evidence": "hooks/keyword-detector.py:88-108"
    },
    {
      "from": "hook:keyword-detector",
      "to": "context:think-mode",
      "type": "context-injection",
      "condition": "think\\s*(deeply|hard|carefully)",
      "note": "Injects additionalContext for extended reasoning - does NOT dispatch",
      "evidence": "hooks/keyword-detector.py:111-127"
    },
    {
      "from": "cmd:workflows-review",
      "to": "agent:review-security-sentinel",
      "condition": ">3 files OR risky areas",
      "evidence": "commands/workflows/review.md:20"
    },
    {
      "from": "cmd:workflows-review",
      "to": "agent:review-architecture-strategist",
      "condition": ">3 files OR risky areas",
      "evidence": "commands/workflows/review.md:20"
    },
    {
      "from": "cmd:workflows-review",
      "to": "agent:review-typescript",
      "condition": ".ts OR .tsx files changed",
      "evidence": "commands/workflows/review.md:21"
    },
    {
      "from": "cmd:workflows-review",
      "to": "agent:review-python",
      "condition": ".py files changed",
      "evidence": "commands/workflows/review.md:22"
    },
    {
      "from": "cmd:workflows-review",
      "to": "agent:review-rails",
      "condition": ".rb files OR Gemfile changed",
      "evidence": "commands/workflows/review.md:23"
    },
    {
      "from": "cmd:workflows-review",
      "to": "agent:review-dhh-rails",
      "condition": ".rb files AND conventional Rails",
      "evidence": "commands/workflows/review.md:23"
    },
    {
      "from": "cmd:workflows-review",
      "to": "agent:review-data-migration-expert",
      "condition": "database migrations changed",
      "evidence": "commands/workflows/review.md:25"
    },
    {
      "from": "cmd:workflows-review",
      "to": "agent:review-data-integrity-guardian",
      "condition": "database migrations changed",
      "evidence": "commands/workflows/review.md:25"
    },
    {
      "from": "cmd:workflows-review",
      "to": "agent:review-deployment-verification",
      "condition": "config/deploy files changed",
      "evidence": "commands/workflows/review.md:26"
    },
    {
      "from": "cmd:workflows-review",
      "to": "agent:review-frontend-races",
      "condition": "frontend async/state code changed",
      "evidence": "commands/workflows/review.md:27"
    },
    {
      "from": "cmd:workflows-review",
      "to": "agent:review-performance-oracle",
      "condition": "performance-sensitive paths changed",
      "evidence": "commands/workflows/review.md:28"
    },
    {
      "from": "cmd:workflows-review",
      "to": "agent:review-agent-native",
      "condition": "agent/prompt files changed",
      "evidence": "commands/workflows/review.md:29"
    },
    {
      "from": "cmd:workflows-review",
      "to": "agent:review-code-simplicity",
      "condition": "complex logic present",
      "evidence": "commands/workflows/review.md:30"
    },
    {
      "from": "cmd:workflows-review",
      "to": "agent:review-pattern-recognition",
      "condition": "pattern violations suspected",
      "evidence": "commands/workflows/review.md:31"
    },
    {
      "from": "cmd:workflows-review",
      "to": "expert:code-reviewer",
      "condition": "Codex adversarial pass",
      "evidence": "commands/workflows/review.md"
    },
    {
      "from": "cmd:delegator-task",
      "to": "expert:architect",
      "condition": "architecture|tradeoffs|design",
      "evidence": "rules/delegator/triggers.md"
    },
    {
      "from": "cmd:delegator-task",
      "to": "expert:plan-reviewer",
      "condition": "review plan",
      "evidence": "rules/delegator/triggers.md"
    },
    {
      "from": "cmd:delegator-task",
      "to": "expert:scope-analyst",
      "condition": "ambiguous|scope",
      "evidence": "rules/delegator/triggers.md"
    },
    {
      "from": "cmd:delegator-task",
      "to": "expert:code-reviewer",
      "condition": "review code",
      "evidence": "rules/delegator/triggers.md"
    },
    {
      "from": "cmd:delegator-task",
      "to": "expert:security-analyst",
      "condition": "security review",
      "evidence": "rules/delegator/triggers.md"
    },
    {
      "from": "cmd:workflows-plan",
      "to": "skill:writing-plans",
      "condition": "command invocation",
      "evidence": "skills/writing-plans/SKILL.md"
    },
    {
      "from": "cmd:workflows-brainstorm",
      "to": "skill:brainstorming",
      "condition": "command invocation",
      "evidence": "skills/brainstorming/SKILL.md"
    },
    {
      "from": "cmd:workflows-work",
      "to": "skill:executing-plans",
      "condition": "command invocation",
      "evidence": "skills/ExecutingPlans/SKILL.md"
    },
    {
      "from": "cmd:workflows-compound",
      "to": "skill:compound",
      "condition": "command invocation",
      "evidence": "skills/Compound/SKILL.md"
    },
    {
      "from": "cmd:workflows-review",
      "to": "skill:review",
      "condition": "command invocation",
      "evidence": "skills/Review/SKILL.md"
    }
  ]
}
